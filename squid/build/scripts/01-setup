#! /bin/sh

set -e
set -x
export DEBIAN_FRONTEND=noninteractive

##
## install squid3
##
apt-get install --no-install-recommends -y squid3

##
## configure squid3
##
cp -a /etc/squid3/squid.conf /etc/squid3/squid.conf.orig
install -m 644 -o root -g root -p /build/etc/squid3/squid.conf /etc/squid3/squid.conf
etckeeper commit "squid: allow from localnet (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, fc00::/7, fe80::/10)"

##
## workaround for squid3 init script: "/etc/init.d/squid3 stop" fails
##
cp -a /etc/init.d/squid3 /etc/init.d/squid3.orig
install -m 755 -o root -g root -p /build/etc/init.d/squid3 /etc/init.d/squid3
etckeeper commit "squid: workaround for init script"
