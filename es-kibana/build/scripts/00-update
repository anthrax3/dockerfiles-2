#! /bin/sh

set -e
set -x
export DEBIAN_FRONTEND=noninteractive

##
## reset user.email for etckeeper
##
git config --global user.email "root@`hostname`"

##
## configure http_proxy for apt
##
if [ "${http_proxy}" ]; then
  echo "Acquire::http::proxy \"${http_proxy}\";" > /etc/apt/apt.conf.d/proxy.conf
  if [ -x /usr/bin/etckeeper ]; then
    if etckeeper unclean; then
      etckeeper commit "Enabled http_proxy for apt"
    fi
  fi
fi

##
## upgrade installed packages
##
apt-get update
apt-get dist-upgrade --no-install-recommends -y

