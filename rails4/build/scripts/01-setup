#! /bin/sh

set -e
set -x
export DEBIAN_FRONTEND=noninteractive

## RDBMS client and headers, and rails
packages="sqlite3 libsqlite3-dev"
packages="$packages mysql-client libmysqlclient-dev"
packages="$packages postgresql-client libpq-dev"

## install packages
apt-get install --install-recommends -y ${packages}

## install ruby (see https://github.com/minimum2scp/ruby-binary)
git clone https://github.com/minimum2scp/ruby-binary.git /tmp/build/rails4/tmp/ruby-binary/
cd /tmp/build/rails4/tmp/ruby-binary/
rake install:github_release:install[2.4.1,https://github.com/minimum2scp/ruby-binary/releases/download/v0.1.49/ruby-binary_sid-amd64_2.4.1.tar.gz]
bash -lc "rbenv global 2.4.1"

## install rails (by gem)
bash -lc "RBENV_VERSION=2.4.1 gem install -N rails --version '~> 4.0'"
bash -lc "rbenv rehash"

